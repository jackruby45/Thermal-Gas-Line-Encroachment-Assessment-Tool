<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Thermal–Gas Line Encroachment Assessment Tool</title>
  <link rel="stylesheet" href="index.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" integrity="sha512-GsLlZN/3F2ErC5ifS5QtgpiJtWd43JWSuIgh7mbzZ8zBps+dvLusV+eNQATqgA/HdeKFVgA5v3S/cIrLF7QnIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="module" src="/index.tsx" defer></script>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.15.0",
    "vite": "https://esm.sh/vite@^7.1.3"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
  <div id="root">
    <header class="app-header">
      <h1>Thermal–Gas Line Encroachment Assessment Tool</h1>
      <p class="subtitle">Rev-2.0, By Tim Bickford</p>
    </header>
    <main>
      <form class="project-info-form" onsubmit="return false;">
        <div class="tab-nav">
          <button type="button" class="tab-button active" data-tab="about">About</button>
          <button type="button" class="tab-button" data-tab="instructions">Instructions</button>
          <button type="button" class="tab-button" data-tab="evaluation">Evaluation Information</button>
          <button type="button" class="tab-button" data-tab="data">Heat Source Data</button>
          <button type="button" class="tab-button" data-tab="gas">Gas Line Data</button>
          <button type="button" class="tab-button" data-tab="soil">Soil Data</button>
          <button type="button" class="tab-button" data-tab="field-visit">Field Visit</button>
          <button type="button" class="tab-button" data-tab="calculation">Calculation</button>
          <button type="button" class="tab-button" data-tab="recommendations">Recommendations</button>
          <button type="button" class="tab-button" data-tab="final-report">Final Report</button>
          <button type="button" class="tab-button" data-tab="latex">Latex Report</button>
          <button type="button" class="tab-button" data-tab="assessment-form">Assessment Form</button>
          <button type="button" class="tab-button" data-tab="admin">Admin Login</button>
          <button type="button" class="tab-button" data-tab="heat-trans-theory">Heat Trans Theory</button>
        </div>

        <div class="tab-content">
          <div id="about" class="tab-panel active">
            <h2 class="form-section-header">About This Tool</h2>
            <p class="about-text">
              The primary purpose of this tool is to evaluate heat transfer that will potentially impact existing or proposed gas lines in proximity to below-ground heat sources, such as steam, hot water, or superheated hot water lines.
            </p>
          </div>

          <div id="instructions" class="tab-panel">
            <h2 class="form-section-header">How to Use This Tool</h2>
            <p class="about-text">This guide provides detailed instructions for completing a comprehensive Thermal–Gas Encroachment Assessment. Following these steps will ensure accurate calculations and a well-documented report.</p>

            <h3>Before You Begin</h3>
            <ul>
                <li><strong>Gather Information:</strong> Collect as much data as possible before starting. This includes as-built drawings, operating specifications for the heat source, gas line records, soil survey maps, and any previous field observations.</li>
                <li><strong>Understand Data Quality:</strong> Many fields allow you to specify if the data is "Actual," "Assumed," or "Unknown." Use these qualifiers accurately. They are critical for understanding the confidence level of the final results and will be reflected in the reports.</li>
            </ul>
          
            <h3>Step 1: Enter All Known Data</h3>
            <p>Navigate through the data entry tabs sequentially. The more complete and accurate the data, the more reliable the assessment will be.</p>
            <ul>
              <li><strong>Evaluation Information:</strong> Fill in the administrative details of the assessment. This includes the project name, location, date, and the names of all personnel involved. A clear project description is essential for context.</li>
              <li><strong>Heat Source Data:</strong> Document everything about the heat-producing line. This includes its type (steam, hot water), operator contact details, operating temperature and pressure, age, pipe material, dimensions, and insulation details.</li>
              <li><strong>Gas Line Data:</strong> Provide detailed information about the gas pipeline being assessed. This includes its operator, material (e.g., plastic, coated steel), dimensions, pressure, and its geometric relationship (orientation and distance) to the heat source.</li>
              <li><strong>Soil Data:</strong> Define the thermal environment. Select the native soil type, which auto-populates a standard thermal conductivity value that you can override if you have more specific data. Document moisture content and average ground temperature. Detail any special bedding material (like sand) used for either pipeline.</li>
              <li><strong>Field Visit:</strong> Record on-site findings. Document the date of the visit, personnel present, weather conditions, and crucial observations like visible signs of heat loss (melted snow, stressed vegetation), surface conditions, and proximity to other utilities.</li>
            </ul>
          
            <h3>Step 2: Perform the Calculation</h3>
            <p>Once all data has been entered, navigate to the <strong>Calculation</strong> tab. This tab serves two purposes:</p>
            <ol>
              <li><strong>Review Your Inputs:</strong> First, it presents a complete, read-only summary of all the data you entered. Carefully review this summary to ensure everything is correct before proceeding.</li>
              <li><strong>Run the Analysis:</strong> Click the <strong>"Calculate Temperature at Gas Line"</strong> button. The tool will perform the heat transfer calculations based on your inputs. The results will appear below the button, showing the calculated gas line temperature and other key thermal metrics.</li>
            </ol>
            <p><strong>Important:</strong> The tool will display a prominent warning if the calculated temperature exceeds the material-specific allowable limits for the gas pipe or its coating. For plastic pipes, a conservative operational limit of 70°F is used for the primary warning to ensure long-term safety.</p>

            <h3>Step 3: Add Actionable Recommendations</h3>
            <p>Go to the <strong>Recommendations</strong> tab. Based on the calculation results and your overall assessment, add specific, actionable recommendations. You can add as many as needed. These could include recommendations for monitoring, mitigation (e.g., installing a heat shield), further investigation, or changes to operational procedures. These user-defined recommendations are a critical part of the final report.</p>
          
            <h3>Step 4: Generate Reports</h3>
            <p>The tool provides several reporting options to document and communicate your findings:</p>
            <ul>
              <li><strong>Final Report:</strong> <em>(Admin access required)</em> This is the most comprehensive output. It guides you through a series of contextual questions and then generates a formal, multi-section engineering report. This report synthesizes all input data, calculation results, risk analysis based on your answers, and your specific recommendations into a professional, readable format.</li>
              <li><strong>Latex Report:</strong> For users who need to incorporate the findings into formal scientific or engineering documents, this tab provides a complete summary report formatted in LaTeX code. You can copy this code and paste it into any LaTeX editor.</li>
              <li><strong>Assessment Form:</strong> This tab provides a clean, printable summary of all the data you entered. It is ideal for archiving, internal reviews, or as an appendix to other documents.</li>
            </ul>
          
            <h3>Step 5: Save and Load Your Work</h3>
            <p>Use the buttons at the bottom of the form to manage your assessment files.</p>
            <ul>
              <li><strong>Save Assessment:</strong> This downloads a single <code>.json</code> file containing all your entered data, questionnaire answers, and the generated final report. This allows you to archive your exact state of work.</li>
              <li><strong>Load Assessment:</strong> This allows you to select a previously saved <code>.json</code> file, which will repopulate the entire form and all its fields, enabling you to continue a previous assessment.</li>
            </ul>
          </div>

          <div id="evaluation" class="tab-panel">
            <div class="form-group">
              <label for="date">Date:</label>
              <input type="date" id="date" name="date" required>
            </div>
            <div class="form-group">
              <label for="numEvaluators">Number of Evaluators:</label>
              <select id="numEvaluators" name="numEvaluators">
                <option value="1" selected>1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </div>
            <div class="form-group">
              <label for="evaluatorNamesContainer">Evaluator Name(s):</label>
              <div id="evaluatorNamesContainer">
                <!-- Dynamic inputs will be generated here -->
              </div>
            </div>
            <div class="form-group">
              <label for="engineerName">Engineer’s Name:</label>
              <input type="text" id="engineerName" name="engineerName" placeholder="Enter name">
            </div>
            <div class="form-group">
              <label for="projectName">Project Name:</label>
              <input type="text" id="projectName" name="projectName" placeholder="Enter project name">
            </div>
            <div class="form-group">
              <label for="projectLocation">Project Location:</label>
              <input type="text" id="projectLocation" name="projectLocation" placeholder="Enter location">
            </div>
            <div class="form-group">
              <label for="projectDescription">Project Description:</label>
              <div class="textarea-wrapper">
                <textarea id="projectDescription" name="projectDescription" rows="4" placeholder="Describe the project..."></textarea>
                <button type="button" id="rewordProjectDescription" class="reword-button hidden" aria-label="Reword Project Description">Reword</button>
              </div>
            </div>
          </div>

          <div id="data" class="tab-panel">
            <h2 id="heatSourceHeader" class="form-section-header">Heat Source Data</h2>
            <div class="form-group">
              <label class="form-label">Buried Heat Source Type:</label>
              <div class="radio-group">
                <div class="radio-option">
                  <input type="radio" id="steamLine" name="heatSourceType" value="steam" checked>
                  <label for="steamLine">Steam Line</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="hotWaterLine" name="heatSourceType" value="hotWater">
                  <label for="hotWaterLine">Hot Water Line</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="superHeatedHotWaterLine" name="heatSourceType" value="superHeatedHotWater">
                  <label for="superHeatedHotWaterLine">Super Heated Hot Water Line</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="other" name="heatSourceType" value="other">
                  <label for="other">Other</label>
                </div>
              </div>
              <div id="customHeatSourceWrapper" class="form-group hidden">
                <label for="customHeatSourceType">Specify Other Heat Source:</label>
                <input type="text" id="customHeatSourceType" name="customHeatSourceType" placeholder="Enter heat source type">
              </div>
            </div>

            <div id="conditionalFields" class="hidden">
              <div class="form-group">
                <label for="operatorName" id="operatorNameLabel">Heat Source - Name of Individual(s) Providing Data:</label>
                <input type="text" id="operatorName" name="operatorName" placeholder="Enter name of individual">
              </div>
              <div class="form-group">
                <label for="operatorCompanyName" id="operatorCompanyNameLabel">Heat Source - Operator Company Name:</label>
                <input type="text" id="operatorCompanyName" name="operatorCompanyName" placeholder="Enter company name">
              </div>
              <div class="form-group">
                <label for="operatorCompanyAddress" id="operatorCompanyAddressLabel">Heat Source - Operating Company Address:</label>
                <input type="text" id="operatorCompanyAddress" name="operatorCompanyAddress" placeholder="Enter company address">
              </div>
              <div class="form-group">
                <label for="operatorContactInfo" id="operatorContactInfoLabel">Heat Source - Contact Info (Phone or Email):</label>
                <input type="text" id="operatorContactInfo" name="operatorContactInfo" placeholder="Enter phone or email">
              </div>
              <div class="form-group">
                <label class="form-label">Has the heat source line operator Registered Assets with 811 "DigSafe"?</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="registered811Yes" name="isRegistered811" value="yes">
                    <label for="registered811Yes">Yes</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="registered811No" name="isRegistered811" value="no">
                    <label for="registered811No">No</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="registered811Unknown" name="isRegistered811" value="unknown" checked>
                    <label for="registered811Unknown">Unknown</label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label class="form-label">Confirmation of 811 Registration Status:</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="registered811Confirmed" name="registered811Confirmation" value="confirmed">
                    <label for="registered811Confirmed">Confirmed with operator</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="registered811Assumed" name="registered811Confirmation" value="assumed">
                    <label for="registered811Assumed">Assumed</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="registered811ConfirmUnknown" name="registered811Confirmation" value="unknown" checked>
                    <label for="registered811ConfirmUnknown">Unknown</label>
                  </div>
                </div>
              </div>
              <div class="form-group">
                <label for="confirmationDate" id="confirmationDateLabel">Heat Source Data Confirmation Date:</label>
                <input type="date" id="confirmationDate" name="confirmationDate">
              </div>
              <div class="form-group">
                <label for="maxTemp" id="maxTempLabel">Max Operating Temp (°F) confirmed by the operator:</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="tempTypeUnknown" name="tempType" value="unknown" checked>
                    <label for="tempTypeUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="tempTypeActual" name="tempType" value="actual">
                    <label for="tempTypeActual">Actual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="tempTypeEstimated" name="tempType" value="estimated">
                    <label for="tempTypeEstimated">Estimated</label>
                  </div>
                </div>
                <input type="number" id="maxTemp" name="maxTemp" placeholder="Enter temperature in °F">
              </div>
              <div class="form-group">
                <label for="maxPressure" id="maxPressureLabel">Max Operating Pressure in psig:</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="pressureTypeUnknown" name="pressureType" value="unknown" checked>
                    <label for="pressureTypeUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="pressureTypeActual" name="pressureType" value="actual">
                    <label for="pressureTypeActual">Actual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="pressureTypeAssumed" name="pressureType" value="assumed">
                    <label for="pressureTypeAssumed">Assumed</label>
                  </div>
                </div>
                <input type="number" id="maxPressure" name="maxPressure" placeholder="Enter pressure in psig">
              </div>
              <div class="form-group">
                <label for="heatSourceAge" id="heatSourceAgeLabel">Heat Source Line Age (years):</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="ageTypeUnknown" name="ageType" value="unknown" checked>
                    <label for="ageTypeUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="ageTypeActual" name="ageType" value="actual">
                    <label for="ageTypeActual">Actual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="ageTypeAssumed" name="ageType" value="assumed">
                    <label for="ageTypeAssumed">Assumed</label>
                  </div>
                </div>
                <input type="number" id="heatSourceAge" name="heatSourceAge" placeholder="Enter age in years" min="0">
              </div>
              <div class="form-group">
                <label for="systemDutyCycle" id="systemDutyCycleLabel">System Duty Cycle / Uptime:</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="dutyCycleTypeUnknown" name="dutyCycleType" value="unknown" checked>
                    <label for="dutyCycleTypeUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="dutyCycleTypeActual" name="dutyCycleType" value="actual">
                    <label for="dutyCycleTypeActual">Actual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="dutyCycleTypeAssumed" name="dutyCycleType" value="assumed">
                    <label for="dutyCycleTypeAssumed">Assumed</label>
                  </div>
                </div>
                <div class="textarea-wrapper">
                  <textarea id="systemDutyCycle" name="systemDutyCycle" rows="3" placeholder="e.g., '24/7 continuous', '12 hours/day on weekdays', 'active only during winter months'"></textarea>
                  <button type="button" id="rewordSystemDutyCycle" class="reword-button hidden" aria-label="Reword System Duty Cycle">Reword</button>
                </div>
              </div>
              <div class="form-group">
                <label for="pipeCasingInfo" id="casingInfoLabel">Pipe Casing / Conduit Information:</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="casingInfoTypeUnknown" name="casingInfoType" value="unknown" checked>
                    <label for="casingInfoTypeUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="casingInfoTypeActual" name="casingInfoType" value="actual">
                    <label for="casingInfoTypeActual">Actual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="casingInfoTypeAssumed" name="casingInfoType" value="assumed">
                    <label for="casingInfoTypeAssumed">Assumed</label>
                  </div>
                </div>
                <div class="textarea-wrapper">
                  <textarea id="pipeCasingInfo" name="pipeCasingInfo" rows="3" placeholder="Describe casing material, diameter, and what fills the space (e.g., air, insulation)."></textarea>
                  <button type="button" id="rewordPipeCasingInfo" class="reword-button hidden" aria-label="Reword Pipe Casing Information">Reword</button>
                </div>
              </div>
              <div class="form-group">
                <label for="heatLossEvidence">Evidence of Heat Loss at the Surface:</label>
                <div class="form-group-info">
                  Have any visual indicators of heat loss ever been observed at the ground surface above the heat line's path? Examples include lines of melted snow in winter, unusually dry or yellowed grass in summer, or steam venting from manholes.
                </div>
                <div class="radio-group horizontal" style="margin-top: 0.75rem; margin-bottom: 0.5rem;">
                  <div class="radio-option">
                    <input type="radio" id="heatLossSourceFieldVisit" name="heatLossEvidenceSource" value="fieldVisit" checked>
                    <label for="heatLossSourceFieldVisit">Based on Field Visit</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="heatLossSourceOperator" name="heatLossEvidenceSource" value="operatorInfo">
                    <label for="heatLossSourceOperator">Info From Operator</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="heatLossSourceOther" name="heatLossEvidenceSource" value="other">
                    <label for="heatLossSourceOther">Other</label>
                  </div>
                </div>
                <div id="customHeatLossSourceWrapper" class="form-group hidden">
                  <label for="customHeatLossSource">Specify Other Source:</label>
                  <input type="text" id="customHeatLossSource" name="customHeatLossSource" placeholder="Enter other source">
                </div>
                <div class="textarea-wrapper">
                  <textarea id="heatLossEvidence" name="heatLossEvidence" rows="3" placeholder="Describe any observations..."></textarea>
                  <button type="button" id="rewordHeatLossEvidence" class="reword-button hidden" aria-label="Reword Heat Loss Evidence">Reword</button>
                </div>
              </div>
              <div class="form-group">
                <label for="pipelineDiameter" id="pipelineDiameterLabel">Heat Source Pipeline Nominal Diameter (inches):</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="diameterTypeUnknown" name="diameterType" value="unknown" checked>
                    <label for="diameterTypeUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="diameterTypeActual" name="diameterType" value="actual">
                    <label for="diameterTypeActual">Actual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="diameterTypeAssumed" name="diameterType" value="assumed">
                    <label for="diameterTypeAssumed">Assumed</label>
                  </div>
                </div>
                <select id="pipelineDiameter" name="pipelineDiameter" required>
                  <option value="" disabled selected>Select diameter...</option>
                  <option value="1">1</option>
                  <option value="1.25">1.25</option>
                  <option value="1.5">1.5</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="8">8</option>
                  <option value="10">10</option>
                  <option value="12">12</option>
                  <option value="14">14</option>
                  <option value="16">16</option>
                  <option value="18">18</option>
                  <option value="20">20</option>
                  <option value="22">22</option>
                  <option value="24">24</option>
                  <option value="26">26</option>
                  <option value="30">30</option>
                  <option value="36">36</option>
                </select>
              </div>
              <div class="form-group">
                <label for="pipeMaterial" id="pipeMaterialLabel">Heat Source Pipe Material:</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="materialTypeUnknown" name="materialType" value="unknown" checked>
                    <label for="materialTypeUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="materialTypeActual" name="materialType" value="actual">
                    <label for="materialTypeActual">Actual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="materialTypeAssumed" name="materialType" value="assumed">
                    <label for="materialTypeAssumed">Assumed</label>
                  </div>
                </div>
                <select id="pipeMaterial" name="pipeMaterial" required>
                    <option value="" disabled selected>Select material...</option>
                    <option value="carbon-steel">Carbon Steel (k=26)</option>
                    <option value="stainless-steel">Stainless Steel (k=9)</option>
                    <option value="ductile-iron">Ductile Iron (k=32)</option>
                    <option value="cast-iron">Cast Iron (Legacy) (k=27)</option>
                    <option value="copper">Copper (k=223)</option>
                    <option value="pex">PEX (Hot Water Only) (k=0.26)</option>
                    <option value="pp-r">PP-R / PP-RCT (Hot Water Only) (k=0.22)</option>
                    <option value="frp">Fiberglass Reinforced Pipe (FRP) (k=0.3)</option>
                    <option value="other">Other (specify)...</option>
                </select>
                <div id="thermalConductivityDisplay" class="form-group-info hidden"></div>
              </div>
              <div id="customPipeMaterialWrapper" class="hidden">
                <div class="form-group">
                  <label for="customPipeMaterial" id="customPipeMaterialLabel">Custom Pipe Material Name:</label>
                  <input type="text" id="customPipeMaterial" name="customPipeMaterial" placeholder="Enter material name">
                </div>
                <div class="form-group">
                  <label for="customThermalConductivity" id="customThermalConductivityLabel">Thermal Conductivity (BTU/hr·ft·°F):</label>
                  <input type="number" id="customThermalConductivity" name="customThermalConductivity" placeholder="Enter value in BTU/hr·ft·°F" step="0.01">
                </div>
              </div>
              <div class="form-group">
                <label for="wallThickness" id="wallThicknessLabel">Heat Source Pipe Wall Thickness (inches):</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="wallThicknessTypeUnknown" name="wallThicknessType" value="unknown" checked>
                    <label for="wallThicknessTypeUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="wallThicknessTypeActual" name="wallThicknessType" value="actual">
                    <label for="wallThicknessTypeActual">Actual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="wallThicknessTypeAssumed" name="wallThicknessType" value="assumed">
                    <label for="wallThicknessTypeAssumed">Assumed</label>
                  </div>
                </div>
                <select id="wallThickness" name="wallThickness" required disabled>
                  <option value="" disabled selected>Select diameter first...</option>
                </select>
                <div id="customWallThicknessWrapper" class="hidden">
                  <input type="number" id="customWallThickness" name="customWallThickness" placeholder="Enter custom thickness in inches" step="0.001">
                </div>
              </div>
              <div class="form-group">
                <label for="connectionTypes" id="connectionTypesLabel">Heat source line connection types:</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="connectionTypesTypeUnknown" name="connectionTypesType" value="unknown" checked>
                    <label for="connectionTypesTypeUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="connectionTypesTypeActual" name="connectionTypesType" value="actual">
                    <label for="connectionTypesTypeActual">Actual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="connectionTypesTypeAssumed" name="connectionTypesType" value="assumed">
                    <label for="connectionTypesTypeAssumed">Assumed</label>
                  </div>
                </div>
                <select id="connectionTypes" name="connectionTypes" multiple required>
                    <!-- Welded (Primary for Steel - Steam/Hot Water) -->
                    <option value="butt-welded">Butt-welded (Steel)</option>
                    <option value="socket-welded">Socket-welded (Steel, typically ≤ 2")</option>
                    <option value="field-welded-sleeves">Field-welded sleeves/repair clamps (Steel)</option>

                    <!-- Flanged (All materials, for serviceability) -->
                    <option value="flanged-gasketed">Flanged with Gasket (Steel, Ductile Iron)</option>

                    <!-- Mechanical Joints (Ductile Iron, Steel) -->
                    <option value="grooved-coupling">Grooved Mechanical Coupling (e.g., Victaulic)</option>
                    <option value="mechanical-joint-di">Mechanical Joint (MJ) (Ductile Iron)</option>
                    <option value="push-on-joint-di">Push-on (Tyton®-style) Joint (Ductile Iron)</option>
                    <option value="restrained-joints">Restrained Joints (e.g., TR-Flex®) (Ductile Iron)</option>

                    <!-- Brazed/Soldered (Copper - Hot Water/Low-Pressure Steam) -->
                    <option value="brazed">Brazed (Copper)</option>
                    <option value="soldered">Soldered (Copper - Low-temp Hot Water only)</option>

                    <!-- Plastic Fusion (PP-R - Hot Water) -->
                    <option value="butt-fusion-ppr">Butt-fusion (PP-R)</option>
                    <option value="socket-fusion-ppr">Socket-fusion (PP-R)</option>

                    <!-- PEX Systems (Hot Water) -->
                    <option value="pex-expansion-crimp">Expansion, Crimp, or Clamp Fittings (PEX)</option>

                    <!-- Pre-Insulated Systems -->
                    <option value="pre-insulated-joint-kit">Pre-insulated Joint Kit (e.g., Heat-Shrink Sleeve, Field Foam)</option>
                    
                    <!-- Legacy/Other -->
                    <option value="threaded-screwed">Threaded/Screwed (Low-pressure/temp applications)</option>
                    <option value="bell-spigot-legacy">Bell-and-spigot (Lead/Oakum - Legacy Cast Iron)</option>
                    <option value="other">Other (specify)...</option>
                </select>
                <div class="form-group-info">Hold Ctrl (or Cmd on Mac) to select multiple options.</div>
                <div id="selectedConnectionTypesDisplay" class="hidden"></div>
                <div id="customConnectionTypesWrapper" class="hidden">
                  <label for="customConnectionTypes">Specify "Other" Connection Types:</label>
                  <textarea id="customConnectionTypes" name="customConnectionTypes" rows="2" placeholder="Describe other connection types..."></textarea>
                </div>
              </div>
              <div class="form-group">
                <label for="pipeInsulationType" id="pipeInsulationTypeLabel">Heat Source Pipe Insulation Type:</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="insulationTypeTypeUnknown" name="insulationTypeType" value="unknown" checked>
                    <label for="insulationTypeTypeUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="insulationTypeTypeActual" name="insulationTypeType" value="actual">
                    <label for="insulationTypeTypeActual">Actual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="insulationTypeTypeAssumed" name="insulationTypeType" value="assumed">
                    <label for="insulationTypeTypeAssumed">Assumed</label>
                  </div>
                </div>
                <select id="pipeInsulationType" name="pipeInsulationType" required>
                  <option value="" disabled selected>Select heat source type first...</option>
                </select>
                <div id="insulationThermalConductivityDisplay" class="form-group-info hidden"></div>
              </div>
              <div id="customPipeInsulationWrapper" class="hidden">
                <div class="form-group">
                  <label for="customPipeInsulation" id="customPipeInsulationLabel">Custom Pipe Insulation Name:</label>
                  <input type="text" id="customPipeInsulation" name="customPipeInsulation" placeholder="Enter insulation name">
                </div>
                <div class="form-group">
                  <label for="customInsulationThermalConductivity" id="customInsulationThermalConductivityLabel">Thermal Conductivity (BTU/hr·ft·°F):</label>
                  <input type="number" id="customInsulationThermalConductivity" name="customInsulationThermalConductivity" placeholder="Enter value in BTU/hr·ft·°F" step="0.001">
                </div>
              </div>
              <div id="insulationThicknessWrapper" class="form-group hidden">
                <label for="insulationThickness" id="insulationThicknessLabel">Insulation Thickness (inches):</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="insulationThicknessTypeUnknown" name="insulationThicknessType" value="unknown" checked>
                    <label for="insulationThicknessTypeUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="insulationThicknessTypeActual" name="insulationThicknessType" value="actual">
                    <label for="insulationThicknessTypeActual">Actual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="insulationThicknessTypeAssumed" name="insulationThicknessType" value="assumed">
                    <label for="insulationThicknessTypeAssumed">Assumed</label>
                  </div>
                </div>
                <input type="number" id="insulationThickness" name="insulationThickness" placeholder="Enter thickness in inches" min="0" step="0.1">
              </div>
              <div class="form-group">
                <label for="insulationCondition">Known Condition of Insulation:</label>
                <div class="form-group-info">
                  Is there any information available about the current physical condition of the heat line's insulation? For example, has it been documented as being degraded, water-logged, or damaged in any way?
                </div>
                <div class="radio-group horizontal" style="margin-top: 0.75rem; margin-bottom: 0.5rem;">
                  <div class="radio-option">
                    <input type="radio" id="insulationConditionSourceUnknown" name="insulationConditionSource" value="unknown" checked>
                    <label for="insulationConditionSourceUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="insulationConditionSourceOperator" name="insulationConditionSource" value="operatorInfo">
                    <label for="insulationConditionSourceOperator">Info From Operator</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="insulationConditionSourceAssumed" name="insulationConditionSource" value="assumed">
                    <label for="insulationConditionSourceAssumed">Assumed</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="insulationConditionSourceOther" name="insulationConditionSource" value="other">
                    <label for="insulationConditionSourceOther">Other</label>
                  </div>
                </div>
                <div id="customInsulationConditionSourceWrapper" class="form-group hidden">
                  <label for="customInsulationConditionSource">Specify Other Source:</label>
                  <input type="text" id="customInsulationConditionSource" name="customInsulationConditionSource" placeholder="Enter other source">
                </div>
                <div class="textarea-wrapper">
                  <textarea id="insulationCondition" name="insulationCondition" rows="3" placeholder="Describe the insulation's condition..."></textarea>
                  <button type="button" id="rewordInsulationCondition" class="reword-button hidden" aria-label="Reword Insulation Condition">Reword</button>
                </div>
              </div>
              <div class="form-group">
                <label for="heatSourceDepth" id="heatSourceDepthLabel">Depth from Ground Surface to Pipe Centerline (feet):</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="depthTypeUnknown" name="depthType" value="unknown" checked>
                    <label for="depthTypeUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="depthTypeActual" name="depthType" value="actual">
                    <label for="depthTypeActual">Actual</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="depthTypeAssumed" name="depthType" value="assumed">
                    <label for="depthTypeAssumed">Assumed</label>
                  </div>
                </div>
                <input type="number" id="heatSourceDepth" name="heatSourceDepth" placeholder="Enter depth in feet" step="0.1" min="0">
              </div>
              <div class="form-group">
                <label for="additionalInfo" id="additionalInfoLabel">Additional Information Provided by the Operator:</label>
                <div class="textarea-wrapper">
                  <textarea id="additionalInfo" name="additionalInfo" rows="4" placeholder="Include any other relevant details..."></textarea>
                  <button type="button" id="rewordAdditionalInfo" class="reword-button hidden" aria-label="Reword Additional Information">Reword</button>
                </div>
              </div>
            </div>
          </div>

          <div id="gas" class="tab-panel">
            <h2 class="form-section-header">Gas Line Data</h2>
            <div class="form-group">
                <label for="gasOperatorName">Gas Line Operator Name:</label>
                <select id="gasOperatorName" name="gasOperatorName" required>
                    <option value="" disabled selected>Select operator...</option>
                    <option value="nu-nh">NU-NH</option>
                    <option value="nu-me">NU-ME</option>
                    <option value="fge">FG&E</option>
                    <option value="bng">BNG</option>
                    <option value="mng">MNG</option>
                    <option value="gsgt">GSGT</option>
                    <option value="unh">UNH</option>
                    <option value="other">Other (specify)...</option>
                </select>
                <div id="customGasOperatorNameWrapper" class="hidden">
                    <label for="customGasOperatorName" class="sr-only">Custom Gas Operator Name:</label>
                    <input type="text" id="customGasOperatorName" name="customGasOperatorName" placeholder="Enter custom operator name" style="margin-top: 0.75rem;">
                </div>
            </div>
            <div class="form-group">
              <label for="gasMaxPressure">Gas Line Max Operating Pressure (psig):</label>
              <input type="number" id="gasMaxPressure" name="gasMaxPressure" placeholder="Enter pressure in psig" min="0">
            </div>
            <div class="form-group">
              <label for="gasInstallationYear">Installation Year / Vintage:</label>
              <input type="number" id="gasInstallationYear" name="gasInstallationYear" placeholder="Enter year" min="1900" max="2100">
            </div>
            <div class="form-group">
                <label for="gasPipelineDiameter">Gas Line Pipeline Nominal Diameter (inches):</label>
                <select id="gasPipelineDiameter" name="gasPipelineDiameter" required>
                  <option value="" disabled selected>Select diameter...</option>
                  <option value="1">1</option>
                  <option value="1.25">1.25</option>
                  <option value="1.5">1.5</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="8">8</option>
                  <option value="10">10</option>
                  <option value="12">12</option>
                  <option value="14">14</option>
                  <option value="16">16</option>
                  <option value="18">18</option>
                  <option value="20">20</option>
                  <option value="22">22</option>
                  <option value="24">24</option>
                </select>
            </div>
            <div class="form-group">
              <label class="form-label">Pipe Sizing Standard:</label>
              <div class="radio-group horizontal">
                <div class="radio-option">
                  <input type="radio" id="gasPipeSizingIps" name="gasPipeSizingStandard" value="ips" checked>
                  <label for="gasPipeSizingIps">IPS (Iron Pipe Size)</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="gasPipeSizingCts" name="gasPipeSizingStandard" value="cts">
                  <label for="gasPipeSizingCts">CTS (Copper Tube Size)</label>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="gasPipeMaterial">Gas Pipeline Material:</label>
              <select id="gasPipeMaterial" name="gasPipeMaterial" required>
                <option value="" disabled selected>Select material...</option>
                <optgroup label="Plastic">
                  <option value="hdpe" data-continuous-limit="140" data-utility-cap="70" data-notes="Most common plastic. Max temp is typically 140°F, but utilities often impose a lower cap (e.g., 70°F) to avoid any pressure de-rating.">High-Density Polyethylene (HDPE)</option>
                  <option value="mdpe" data-continuous-limit="140" data-utility-cap="70" data-notes="Often yellow, used in earlier installations. Similar temp limits to HDPE.">Medium-Density Polyethylene (MDPE)</option>
                  <option value="aldyl" data-continuous-limit="100" data-utility-cap="70" data-notes="DuPont brand, a legacy PE material. May have a lower temp threshold (around 100°F).">Aldyl-A</option>
                </optgroup>
                <optgroup label="Steel">
                  <option value="coated-steel-protected">Coated Steel (with Cathodic Protection)</option>
                  <option value="coated-steel-unprotected">Coated Steel (without Cathodic Protection)</option>
                  <option value="bare-steel">Bare Steel (Legacy)</option>
                </optgroup>
                <optgroup label="Other">
                  <option value="pvc">PVC (Polyvinyl Chloride)</option>
                  <option value="cast-iron-gas">Cast Iron (Legacy)</option>
                  <option value="other">Other (specify)...</option>
                </optgroup>
              </select>
            </div>
            <div id="customGasPipeMaterialWrapper" class="hidden">
              <div class="form-group">
                <label for="customGasPipeMaterial">Custom Gas Pipe Material Name:</label>
                <input type="text" id="customGasPipeMaterial" name="customGasPipeMaterial" placeholder="Enter material name">
              </div>
              <div class="form-group">
                <label for="customGasThermalConductivity">Thermal Conductivity (BTU/hr·ft·°F):</label>
                <input type="number" id="customGasThermalConductivity" name="customGasThermalConductivity" placeholder="Enter value" step="0.01">
              </div>
            </div>
            <div id="gasWallThicknessGroup" class="form-group hidden">
              <label for="gasWallThickness">Gas Pipe Wall Thickness (inches):</label>
              <select id="gasWallThickness" name="gasWallThickness" disabled>
                <option value="" disabled selected>Select diameter first...</option>
              </select>
              <div id="customGasWallThicknessWrapper" class="hidden">
                <input type="number" id="customGasWallThickness" name="customGasWallThickness" placeholder="Enter custom thickness in inches" step="0.001">
              </div>
            </div>
            <div id="gasSdrGroup" class="form-group hidden">
              <label for="gasSdr">Gas Pipe SDR (Standard Dimension Ratio):</label>
              <select id="gasSdr" name="gasSdr">
                  <option value="" disabled selected>Select SDR...</option>
                  <option value="17">SDR 17</option>
                  <option value="13.5">SDR 13.5</option>
                  <option value="11">SDR 11</option>
                  <option value="9">SDR 9</option>
                  <option value="other">Other (specify)...</option>
              </select>
              <div id="customGasSdrWrapper" class="hidden">
                  <input type="text" id="customGasSdr" name="customGasSdr" placeholder="Enter custom SDR value" style="margin-top: 0.75rem;">
              </div>
            </div>
            <div id="gasCoatingTypeWrapper" class="form-group hidden">
              <label for="gasCoatingType">Coating Type:</label>
              <select id="gasCoatingType" name="gasCoatingType">
                  <option value="" disabled selected>Select coating...</option>
                  <option value="fbe" data-max-temp="150">Fusion Bonded Epoxy (FBE) - Max Temp: 150°F</option>
                  <option value="coal-tar" data-max-temp="120">Coal Tar Enamel - Max Temp: 120°F</option>
                  <option value="polyethylene-tape" data-max-temp="140">Polyethylene Tape Wrap - Max Temp: 140°F</option>
                  <option value="asphalt-enamel" data-max-temp="160">Asphalt Enamel - Max Temp: 160°F</option>
                  <option value="other">Other (specify)...</option>
              </select>
              <div id="customGasCoatingTypeWrapper" class="hidden">
                  <input type="text" id="customGasCoatingType" name="customGasCoatingType" placeholder="Enter custom coating type" style="margin-top: 0.75rem;">
              </div>
            </div>
            <div class="form-group">
              <label class="form-label">Gas Line Orientation to Heat Source:</label>
              <div class="radio-group horizontal">
                <div class="radio-option">
                  <input type="radio" id="perpendicular" name="gasLineOrientation" value="perpendicular" checked>
                  <label for="perpendicular">Crossing / Perpendicular</label>
                </div>
                <div class="radio-option">
                  <input type="radio" id="parallel" name="gasLineOrientation" value="parallel">
                  <label for="parallel">Parallel</label>
                </div>
              </div>
            </div>
            <div class="form-group">
                <label for="depthOfBurialGasLine">Depth of Burial from Ground Surface to Gas Line Centerline (feet):</label>
                <input type="number" id="depthOfBurialGasLine" name="depthOfBurialGasLine" placeholder="Enter depth in feet" step="0.1" min="0" required>
            </div>
            <div id="parallelDistanceWrapper" class="hidden">
              <div class="form-group">
                <label for="parallelDistance">Distance from Heat Source Centerline to Gas Line Centerline (feet):</label>
                <input type="number" id="parallelDistance" name="parallelDistance" placeholder="Enter distance in feet" step="0.1" min="0">
              </div>
              <div class="form-group">
                <label for="parallelLength">Length of Parallel Section (feet):</label>
                <input type="number" id="parallelLength" name="parallelLength" placeholder="Enter length in feet" step="1" min="0">
              </div>
              <div id="parallelCoordinatesContainer" class="form-group hidden">
                <label>Coordinates of Parallel Section:</label>
                <div class="form-group-info">Enter the latitude and longitude for key points along the parallel section. At minimum, provide start and end points.</div>
                <div id="parallelCoordinatesWrapper"></div>
              </div>
            </div>
            <div id="perpendicularCoordinatesWrapper">
              <div class="form-group">
                <label>Coordinates of Intersection:</label>
                <div class="coordinate-grid">
                  <label for="latitude">Latitude:</label>
                  <input type="number" id="latitude" name="latitude" placeholder="e.g., 42.3601" step="any">
                  <label for="longitude">Longitude:</label>
                  <input type="number" id="longitude" name="longitude" placeholder="e.g., -71.0589" step="any">
                </div>
              </div>
              <div class="form-group">
                <label for="lateralOffset">Lateral Offset from Heat Source Centerline (feet):</label>
                <div class="form-group-info">This is the horizontal distance between the heat source and the gas line at the point of intersection. A value of 0 means the gas line is directly above/below the heat source.</div>
                <input type="number" id="lateralOffset" name="lateralOffset" placeholder="Enter offset in feet" step="0.1" min="0" value="0.0">
              </div>
              <div class="form-group">
                <label for="crossingAngle">Crossing Angle (degrees):</label>
                <div class="form-group-info">Enter the angle at which the gas line crosses the heat source. 90° is a direct perpendicular crossing. An angle less than 90° represents a skewed crossing.</div>
                <input type="number" id="crossingAngle" name="crossingAngle" placeholder="e.g., 90" step="1" min="0" max="90" value="90">
              </div>
            </div>
          </div>

          <div id="soil" class="tab-panel">
            <h2 class="form-section-header">Soil & Bedding Data</h2>
            <div class="form-group">
              <label for="soilType">Native Soil Type Classification:</label>
              <select id="soilType" name="soilType" required>
                <option value="" disabled selected>Select soil type...</option>
                <option value="heavy-clay-damp" data-conductivity="0.9">Heavy Clay Soil, Damp (k=0.9)</option>
                <option value="heavy-clay-dry" data-conductivity="0.6">Heavy Clay Soil, Dry (k=0.6)</option>
                <option value="light-clay-damp" data-conductivity="0.7">Light Clay Soil, Damp (k=0.7)</option>
                <option value="light-clay-dry" data-conductivity="0.4">Light Clay Soil, Dry (k=0.4)</option>
                <option value="sandy-gravel" data-conductivity="1.5">Sandy Gravel (k=1.5)</option>
                <option value="sand-damp" data-conductivity="1.2">Sand, Damp (k=1.2)</option>
                <option value="sand-dry" data-conductivity="0.2">Sand, Dry (k=0.2)</option>
                <option value="rock" data-conductivity="1.2">Rock (k=1.2)</option>
                <option value="loam" data-conductivity="0.7">Loam (k=0.7)</option>
              </select>
            </div>
            <div class="form-group">
              <label for="soilThermalConductivity">Native Soil Thermal Conductivity (BTU/hr·ft·°F):</label>
              <input type="number" id="soilThermalConductivity" name="soilThermalConductivity" placeholder="Value auto-populates from soil type" step="0.01" min="0" required>
            </div>
            <div class="form-group">
              <label for="soilMoistureContent">Soil Moisture Content (%):</label>
              <input type="number" id="soilMoistureContent" name="soilMoistureContent" placeholder="Enter percentage" min="0" max="100">
            </div>
            <div class="form-group">
              <label for="averageGroundTemperature">Average Ground Temperature (°F):</label>
              <input type="number" id="averageGroundTemperature" name="averageGroundTemperature" placeholder="Enter temperature in °F" required>
            </div>
            <div class="form-group">
                <label class="form-label">Evidence of water infiltration or frost heave in the area:</label>
                <div class="radio-group horizontal">
                    <div class="radio-option">
                        <input type="radio" id="waterInfiltrationYes" name="waterInfiltration" value="yes">
                        <label for="waterInfiltrationYes">Yes</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="waterInfiltrationNo" name="waterInfiltration" value="no" checked>
                        <label for="waterInfiltrationNo">No</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="waterInfiltrationUnknown" name="waterInfiltration" value="unknown">
                        <label for="waterInfiltrationUnknown">Unknown</label>
                    </div>
                </div>
                <textarea id="waterInfiltrationComments" name="waterInfiltrationComments" rows="3" placeholder="Add any comments on local drainage, high water table, etc."></textarea>
            </div>

            <div class="sub-section">
              <h3 class="sub-section-header">Heat Source Trench Bedding</h3>
              <div class="form-group">
                <label class="form-label">Was the heat source line installed with sand bedding?</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="heatSourceBeddingUnknown" name="heatSourceBeddingType" value="unknown" checked>
                    <label for="heatSourceBeddingUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="heatSourceBeddingSand" name="heatSourceBeddingType" value="sand">
                    <label for="heatSourceBeddingSand">Yes, Sand Bedding</label>
                  </div>
                </div>
              </div>
              <div id="heatSourceBeddingDetailsWrapper" class="hidden">
                <div class="form-group">
                  <label>Sand Bedding Dimensions (inches from pipe OD):</label>
                  <div class="dimension-grid">
                    <label for="heatSourceBeddingTop">Above:</label>
                    <input type="number" id="heatSourceBeddingTop" name="heatSourceBeddingTop" placeholder="inches" min="0">
                    <label for="heatSourceBeddingBottom">Below:</label>
                    <input type="number" id="heatSourceBeddingBottom" name="heatSourceBeddingBottom" placeholder="inches" min="0">
                    <label for="heatSourceBeddingLeft">Left:</label>
                    <input type="number" id="heatSourceBeddingLeft" name="heatSourceBeddingLeft" placeholder="inches" min="0">
                    <label for="heatSourceBeddingRight">Right:</label>
                    <input type="number" id="heatSourceBeddingRight" name="heatSourceBeddingRight" placeholder="inches" min="0">
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">Sand Thermal Conductivity (k<sub>sand</sub>):</label>
                  <div class="radio-group horizontal">
                    <div class="radio-option">
                      <input type="radio" id="heatSourceBeddingUseDefaultK" name="heatSourceBeddingUseCustomK" value="no" checked>
                      <label for="heatSourceBeddingUseDefaultK">Use Default</label>
                    </div>
                    <div class="radio-option">
                      <input type="radio" id="heatSourceBeddingUseCustomK" name="heatSourceBeddingUseCustomK" value="yes">
                      <label for="heatSourceBeddingUseCustomK">Use Custom Value</label>
                    </div>
                  </div>
                  <div id="heatSourceBeddingDefaultKDisplay" class="form-group-info">Default k<sub>sand</sub> = 0.20 BTU/hr·ft·°F (Dry Sand)</div>
                  <div id="customHeatSourceBeddingKWrapper" class="hidden">
                    <input type="number" id="heatSourceBeddingCustomK" name="heatSourceBeddingCustomK" placeholder="Enter custom k value" step="0.01">
                  </div>
                </div>
              </div>
            </div>
            
            <div class="sub-section">
              <h3 class="sub-section-header">Gas Line Trench Bedding</h3>
              <div class="form-group">
                <label class="form-label">Was the gas line installed with sand bedding?</label>
                <div class="radio-group horizontal">
                  <div class="radio-option">
                    <input type="radio" id="gasBeddingUnknown" name="gasLineBeddingType" value="unknown" checked>
                    <label for="gasBeddingUnknown">Unknown</label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="gasBeddingSand" name="gasLineBeddingType" value="sand">
                    <label for="gasBeddingSand">Yes, Sand Bedding</label>
                  </div>
                </div>
              </div>
              <div id="gasLineBeddingDetailsWrapper" class="hidden">
                <div class="form-group">
                  <label>Sand Bedding Dimensions (inches from pipe OD):</label>
                  <div class="dimension-grid">
                    <label for="gasBeddingTop">Above:</label>
                    <input type="number" id="gasBeddingTop" name="gasBeddingTop" placeholder="inches" min="0">
                    <label for="gasBeddingBottom">Below:</label>
                    <input type="number" id="gasBeddingBottom" name="gasBeddingBottom" placeholder="inches" min="0">
                    <label for="gasBeddingLeft">Left:</label>
                    <input type="number" id="gasBeddingLeft" name="gasBeddingLeft" placeholder="inches" min="0">
                    <label for="gasBeddingRight">Right:</label>
                    <input type="number" id="gasBeddingRight" name="gasBeddingRight" placeholder="inches" min="0">
                  </div>
                </div>
                <div class="form-group">
                  <label class="form-label">Sand Thermal Conductivity (k<sub>sand</sub>):</label>
                  <div class="radio-group horizontal">
                    <div class="radio-option">
                      <input type="radio" id="gasBeddingUseDefaultK" name="gasBeddingUseCustomK" value="no" checked>
                      <label for="gasBeddingUseDefaultK">Use Default</label>
                    </div>
                    <div class="radio-option">
                      <input type="radio" id="gasBeddingUseCustomK" name="gasBeddingUseCustomK" value="yes">
                      <label for="gasBeddingUseCustomK">Use Custom Value</label>
                    </div>
                  </div>
                  <div id="gasBeddingDefaultKDisplay" class="form-group-info">Default k<sub>sand</sub> = 0.20 BTU/hr·ft·°F (Dry Sand)</div>
                  <div id="customGasBeddingKWrapper" class="hidden">
                    <input type="number" id="gasBeddingCustomK" name="gasBeddingCustomK" placeholder="Enter custom k value" step="0.01">
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div id="field-visit" class="tab-panel">
            <h2 class="form-section-header">Field Visit</h2>
            <div class="form-group">
              <label for="visitDate">Date of Visit:</label>
              <input type="date" id="visitDate" name="visitDate">
            </div>
            <div class="form-group">
              <label for="sitePersonnel">Personnel on Site:</label>
              <textarea id="sitePersonnel" name="sitePersonnel" rows="3" placeholder="List names and affiliations..."></textarea>
            </div>
            <div class="form-group">
              <label for="siteConditions">Weather and Site Conditions:</label>
              <textarea id="siteConditions" name="siteConditions" rows="4" placeholder="Describe weather, ground cover, etc."></textarea>
            </div>
            <div class="form-group">
              <label for="fieldObservations">Field Observations and Notes:</label>
              <textarea id="fieldObservations" name="fieldObservations" rows="8" placeholder="Document observations, measurements, other utilities, visual indicators, etc."></textarea>
            </div>
            <div class="form-group">
              <label for="fieldPhotos">Field Photos / Sketches:</label>
              <input type="file" id="fieldPhotos" name="fieldPhotos" multiple accept="image/*">
              <div id="image-preview-container"></div>
            </div>
          </div>
          
          <div id="calculation" class="tab-panel">
            <h2 class="form-section-header">Calculation Summary and Results</h2>
            <div class="summary-container">
              <div class="summary-section">
                <h3>Evaluation Information</h3>
                <div id="summary-evaluation"></div>
              </div>
              <div class="summary-section">
                <h3>Heat Source Data</h3>
                <div id="summary-heat-source"></div>
              </div>
              <div class="summary-section">
                <h3>Gas Line Data</h3>
                <div id="summary-gas-line"></div>
              </div>
              <div class="summary-section">
                <h3>Soil & Bedding Data</h3>
                <div id="summary-soil"></div>
              </div>
              <div class="summary-section">
                <h3>Field Visit Data</h3>
                <div id="summary-field-visit"></div>
              </div>
            </div>
            <div class="form-actions-calculate">
              <button type="button" id="calculateButton" class="action-button">Calculate Temperature at Gas Line</button>
            </div>
            <div id="resultsContainer" class="hidden"></div>
          </div>

          <div id="recommendations" class="tab-panel">
            <h2 class="form-section-header">Recommendations</h2>
            <div id="recommendationsContainer"></div>
            <button type="button" id="addRecommendationButton" class="action-button secondary">Add Recommendation</button>
          </div>
          
          <div id="final-report" class="tab-panel">
            <h2 class="form-section-header">Final Assessment Report</h2>
            <div id="report-admin-only-message">
              <p>This feature is available for administrators only. Please log in on the "Admin Login" tab to generate the final report.</p>
            </div>
            <div id="final-report-content" class="hidden">
              <div id="final-report-start-wrapper">
                <!-- Content will be dynamically generated by JS -->
              </div>
              <div id="final-report-questionnaire-wrapper" class="hidden">
                <div id="questionnaire-progress">
                  <p id="question-progress-text">Question 1 of N</p>
                  <div class="progress-bar-container">
                    <div id="progress-bar"></div>
                  </div>
                </div>
                <div class="form-group">
                  <label for="question-text" id="question-text-label">Guided Question:</label>
                  <p id="question-text"></p>
                </div>
                <div class="form-group">
                  <label for="question-answer">Your Answer:</label>
                  <div class="textarea-wrapper">
                    <textarea id="question-answer" name="question-answer" rows="5" placeholder="Provide a detailed answer..."></textarea>
                    <button type="button" id="rewordAnswer" class="reword-button hidden" aria-label="Reword Answer">Reword</button>
                  </div>
                </div>
                <div class="questionnaire-actions">
                  <button type="button" id="prev-question-btn" class="action-button secondary" disabled>Previous</button>
                  <button type="button" id="next-question-btn" class="action-button">Next Question</button>
                </div>
              </div>
            </div>
            <div id="report-loading" class="hidden">
              <div id="report-loading-spinner">
                <div class="spinner"></div>
                <p>Generating your comprehensive report... This may take a moment.</p>
              </div>
            </div>
            <div id="generated-report-container" class="hidden">
              <!-- Report will be injected here -->
            </div>
          </div>

          <div id="latex" class="tab-panel">
            <h2 class="form-section-header">LaTeX Report</h2>
            <p>This report provides a complete summary formatted in LaTeX code, suitable for inclusion in formal engineering or scientific documents. Run a calculation first, then copy the code below.</p>
            <div class="form-actions-latex">
                <button type="button" id="copyLatexButton" class="action-button secondary">Copy Report</button>
            </div>
            <div id="latexPlaceholder">
                <p>Run a calculation on the "Calculation" tab to generate the LaTeX report.</p>
            </div>
            <div id="latexContainer" class="hidden">
                <div id="latexReportOutputWrapper">
                    <pre><code id="latexReportOutput"></code></pre>
                </div>
            </div>
          </div>

          <div id="assessment-form" class="tab-panel">
            <h2 class="form-section-header">Printable Assessment Form</h2>
            <p>This provides a clean, printable summary of the assessment form fields. This is ideal for archiving, internal reviews, or taking into the field.</p>
            <div class="form-actions-print">
              <button type="button" id="exportPdfButton" class="action-button secondary">Export to PDF</button>
            </div>
            <div id="assessment-form-content">
              <!-- Form content for printing will be generated here by JS -->
            </div>
          </div>

          <div id="admin" class="tab-panel">
            <div id="admin-login-wrapper">
              <div class="form-group">
                <label for="adminPasscode">Admin Passcode:</label>
                <input type="password" id="adminPasscode" name="adminPasscode" placeholder="Enter passcode">
              </div>
              <div id="adminLoginError" class="text-error hidden"></div>
              <button type="button" id="adminExecuteButton" class="action-button">Execute</button>
            </div>
            <div id="admin-content-wrapper" class="hidden">
              <p>You are logged in as an administrator. You now have access to advanced features like AI-powered text rewording and final report generation.</p>
              <button type="button" id="adminLogoutButton" class="action-button secondary">Logout</button>
            </div>
          </div>

          <div id="heat-trans-theory" class="tab-panel">
            <h2 class="form-section-header">Heat Transfer Theory</h2>
            <p>The calculations in this tool are based on established principles of two-dimensional, steady-state heat transfer, specifically utilizing the thermal resistance analogy. This method models the flow of heat from a source to a surrounding medium through various material layers as an electrical circuit, where temperature difference is the voltage, heat flow is the current, and thermal resistance is the electrical resistance.</p>
            
            <blockquote>
              <strong>Disclaimer:</strong> This model is a screening-level tool. It assumes homogeneous soil conditions and does not account for transient effects, moisture migration, or complex three-dimensional geometries. For critical applications, a more detailed analysis using numerical methods like Finite Element Analysis (FEA) may be warranted.
            </blockquote>
          
            <h3>Key Equations Used</h3>
            
            <h4>1. Total Heat Loss (Q)</h4>
            <p>The rate of heat loss per unit length from the heat source to the ambient ground surface is calculated using the total thermal resistance.</p>
            <div class="equation">Q = (T_hs - T_surface) / R_total</div>
          
            <h4>2. Thermal Resistances (R)</h4>
            <p>The total resistance is the sum of the resistances of each layer the heat must pass through: the pipe wall, the insulation (if any), the bedding material (if specified), and the surrounding soil.</p>
            <ul>
              <li><strong>Pipe Wall Resistance:</strong> For a cylindrical pipe.
                <div class="equation">R_pipe = ln(D_outer / D_inner) / (2π * k_pipe)</div>
              </li>
              <li><strong>Insulation Resistance:</strong> For the cylindrical insulation layer.
                <div class="equation">R_insulation = ln(D_ins_outer / D_hs_outer) / (2π * k_ins)</div>
              </li>
              <li><strong>Soil Resistance (Method of Images):</strong> This equation calculates the resistance of the soil from the outer surface of the pipe/insulation to the ground surface, accounting for the insulating effect of the ground surface itself.
                <div class="equation">R_soil = ln((2Z_hs - r_outer) / r_outer) / (2π * k_soil)</div>
              </li>
            </ul>
          
            <h4>3. Gas Line Temperature (T_gas_line)</h4>
            <p>The temperature at the gas line is calculated by determining the temperature rise at its location due to the heat loss (Q) from the heat source. The equation differs based on the orientation.</p>
            <ul>
              <li><strong>Perpendicular Orientation:</strong> Used when the gas line crosses the heat source.
                <div class="equation">T_gas_line = T_surface + (Q / (2π * k_soil)) * ln((Z_hs + Z_gas) / |Z_hs - Z_gas|)</div>
              </li>
              <li><strong>Parallel Orientation:</strong> Used when the gas line runs alongside the heat source. This equation uses the distances from the gas line to the heat source and its "image" above the ground plane.
                <div class="equation">T_gas_line = T_surface + (Q / (2π * k_soil)) * ln(d_image / d_source)</div>
              </li>
            </ul>
            
            <h3>Variable Definitions</h3>
            <ul class="variable-list">
              <li><strong>Q</strong> Heat loss per unit length (BTU/hr·ft)</li>
              <li><strong>T_hs</strong> Temperature of the heat source (°F)</li>
              <li><strong>T_surface</strong> Average ground temperature (°F)</li>
              <li><strong>R_total</strong> Total thermal resistance (hr·ft·°F/BTU)</li>
              <li><strong>k</strong> Thermal conductivity (BTU/hr·ft·°F)</li>
              <li><strong>D</strong> Diameter (ft)</li>
              <li><strong>r</strong> Radius (ft)</li>
              <li><strong>Z_hs</strong> Depth of heat source centerline (ft)</li>
              <li><strong>Z_gas</strong> Depth of gas line centerline (ft)</li>
              <li><strong>d_source</strong> Direct distance between pipes (ft)</li>
              <li><strong>d_image</strong> Distance from gas line to heat source's image (ft)</li>
            </ul>
          </div>
        </div>

        <div class="form-actions">
            <button type="button" id="saveButton" class="action-button secondary">Save Assessment</button>
            <button type="button" id="loadButton" class="action-button secondary">Load Assessment</button>
            <input type="file" id="loadFile" class="sr-only" accept=".json">
        </div>
      </form>
    </main>

    <div id="rewordModal" class="modal-overlay hidden">
      <div class="modal-content">
        <h3 id="rewordModalTitle">AI-Generated Suggestions</h3>
        <p>Select one of the reworded options below to replace your original text.</p>
        <div id="rewordOptionsContainer">
          <!-- Options will be injected here -->
        </div>
        <div class="modal-actions">
          <button type="button" id="cancelReword" class="action-button secondary">Cancel</button>
          <button type="button" id="confirmReword" class="action-button">Confirm & Replace</button>
        </div>
      </div>
    </div>
  </div>
<script type="module" src="/index.tsx"></script>
</body>
</html>